
# This file is automatically generated, you probably don't want to edit this

nonParametricIRTOptions <- if (requireNamespace('jmvcore')) R6::R6Class(
    "nonParametricIRTOptions",
    inherit = jmvcore::Options,
    public = list(
        initialize = function(
            responses = NULL,
            groups = NULL,
            key = NULL,
            weights = NULL,
            itemlabels = NULL,
            format = "formatMC",
            SubRank = NULL,
            miss = "missPermitted",
            NAweight = 0,
            kernel = "gaussian",
            bandwidth = "Silverman",
            RankFun = "sum",
            thetadist = "norm",
            plotItems = NULL, ...) {

            super$initialize(
                package='psychoPDA',
                name='nonParametricIRT',
                requiresData=TRUE,
                ...)

            private$..responses <- jmvcore::OptionVariables$new(
                "responses",
                responses)
            private$..groups <- jmvcore::OptionVariable$new(
                "groups",
                groups)
            private$..key <- jmvcore::OptionVariable$new(
                "key",
                key)
            private$..weights <- jmvcore::OptionVariable$new(
                "weights",
                weights)
            private$..itemlabels <- jmvcore::OptionVariable$new(
                "itemlabels",
                itemlabels)
            private$..format <- jmvcore::OptionList$new(
                "format",
                format,
                options=list(
                    "formatMC",
                    "formatPartial",
                    "formatNominal"),
                default="formatMC")
            private$..SubRank <- jmvcore::OptionVariable$new(
                "SubRank",
                SubRank)
            private$..miss <- jmvcore::OptionList$new(
                "miss",
                miss,
                options=list(
                    "missPermitted",
                    "missRandomUnif",
                    "missRandomMulti",
                    "missROmit"),
                default="missPermitted")
            private$..NAweight <- jmvcore::OptionNumber$new(
                "NAweight",
                NAweight,
                min=0,
                max=1,
                default=0)
            private$..kernel <- jmvcore::OptionList$new(
                "kernel",
                kernel,
                options=list(
                    "gaussian",
                    "quadratic",
                    "uniform"),
                default="gaussian")
            private$..bandwidth <- jmvcore::OptionList$new(
                "bandwidth",
                bandwidth,
                options=list(
                    "Silverman",
                    "CV"),
                default="Silverman")
            private$..RankFun <- jmvcore::OptionList$new(
                "RankFun",
                RankFun,
                options=list(
                    "sum",
                    "mean"),
                default="sum")
            private$..thetadist <- jmvcore::OptionList$new(
                "thetadist",
                thetadist,
                options=list(
                    "norm",
                    "beta",
                    "unif",
                    "gamma"),
                default="norm")
            private$..plotItems <- jmvcore::OptionVariables$new(
                "plotItems",
                plotItems)

            self$.addOption(private$..responses)
            self$.addOption(private$..groups)
            self$.addOption(private$..key)
            self$.addOption(private$..weights)
            self$.addOption(private$..itemlabels)
            self$.addOption(private$..format)
            self$.addOption(private$..SubRank)
            self$.addOption(private$..miss)
            self$.addOption(private$..NAweight)
            self$.addOption(private$..kernel)
            self$.addOption(private$..bandwidth)
            self$.addOption(private$..RankFun)
            self$.addOption(private$..thetadist)
            self$.addOption(private$..plotItems)
        }),
    active = list(
        responses = function() private$..responses$value,
        groups = function() private$..groups$value,
        key = function() private$..key$value,
        weights = function() private$..weights$value,
        itemlabels = function() private$..itemlabels$value,
        format = function() private$..format$value,
        SubRank = function() private$..SubRank$value,
        miss = function() private$..miss$value,
        NAweight = function() private$..NAweight$value,
        kernel = function() private$..kernel$value,
        bandwidth = function() private$..bandwidth$value,
        RankFun = function() private$..RankFun$value,
        thetadist = function() private$..thetadist$value,
        plotItems = function() private$..plotItems$value),
    private = list(
        ..responses = NA,
        ..groups = NA,
        ..key = NA,
        ..weights = NA,
        ..itemlabels = NA,
        ..format = NA,
        ..SubRank = NA,
        ..miss = NA,
        ..NAweight = NA,
        ..kernel = NA,
        ..bandwidth = NA,
        ..RankFun = NA,
        ..thetadist = NA,
        ..plotItems = NA)
)

nonParametricIRTResults <- if (requireNamespace('jmvcore')) R6::R6Class(
    inherit = jmvcore::Group,
    active = list(
        debug = function() private$.items[["debug"]],
        instructions = function() private$.items[["instructions"]],
        text = function() private$.items[["text"]],
        itemPlots = function() private$.items[["itemPlots"]]),
    private = list(),
    public=list(
        initialize=function(options) {
            super$initialize(
                options=options,
                name="",
                title="Non-Parametric IRT")
            self$add(jmvcore::Preformatted$new(
                options=options,
                name="debug",
                title="debug results"))
            self$add(jmvcore::Html$new(
                options=options,
                name="instructions",
                title="Instructions",
                visible=TRUE))
            self$add(jmvcore::Preformatted$new(
                options=options,
                name="text",
                title="Non-Parametric IRT"))
            self$add(jmvcore::Array$new(
                options=options,
                name="itemPlots",
                title="Item Plots",
                items="(plotItems)",
                template=jmvcore::Image$new(
                    options=options,
                    width=550,
                    height=450,
                    renderFun=".itemPlots",
                    visible="(plotItems)",
                    requiresData=TRUE)))}))

nonParametricIRTBase <- if (requireNamespace('jmvcore')) R6::R6Class(
    "nonParametricIRTBase",
    inherit = jmvcore::Analysis,
    public = list(
        initialize = function(options, data=NULL, datasetId="", analysisId="", revision=0) {
            super$initialize(
                package = 'psychoPDA',
                name = 'nonParametricIRT',
                version = c(1,0,0),
                options = options,
                results = nonParametricIRTResults$new(options=options),
                data = data,
                datasetId = datasetId,
                analysisId = analysisId,
                revision = revision,
                pause = NULL,
                completeWhenFilled = FALSE,
                requiresMissings = FALSE)
        }))

#' Non-Parametric IRT
#'
#' 
#' @param data .
#' @param responses .
#' @param groups .
#' @param key .
#' @param weights .
#' @param itemlabels .
#' @param format .
#' @param SubRank .
#' @param miss .
#' @param NAweight .
#' @param kernel .
#' @param bandwidth .
#' @param RankFun .
#' @param thetadist .
#' @param plotItems .
#' @return A results object containing:
#' \tabular{llllll}{
#'   \code{results$debug} \tab \tab \tab \tab \tab a preformatted \cr
#'   \code{results$instructions} \tab \tab \tab \tab \tab a html \cr
#'   \code{results$text} \tab \tab \tab \tab \tab a preformatted \cr
#'   \code{results$itemPlots} \tab \tab \tab \tab \tab an array of images \cr
#' }
#'
#' @export
nonParametricIRT <- function(
    data,
    responses,
    groups,
    key,
    weights,
    itemlabels,
    format = "formatMC",
    SubRank,
    miss = "missPermitted",
    NAweight = 0,
    kernel = "gaussian",
    bandwidth = "Silverman",
    RankFun = "sum",
    thetadist = "norm",
    plotItems) {

    if ( ! requireNamespace('jmvcore'))
        stop('nonParametricIRT requires jmvcore to be installed (restart may be required)')

    if ( ! missing(responses)) responses <- jmvcore::resolveQuo(jmvcore::enquo(responses))
    if ( ! missing(groups)) groups <- jmvcore::resolveQuo(jmvcore::enquo(groups))
    if ( ! missing(key)) key <- jmvcore::resolveQuo(jmvcore::enquo(key))
    if ( ! missing(weights)) weights <- jmvcore::resolveQuo(jmvcore::enquo(weights))
    if ( ! missing(itemlabels)) itemlabels <- jmvcore::resolveQuo(jmvcore::enquo(itemlabels))
    if ( ! missing(SubRank)) SubRank <- jmvcore::resolveQuo(jmvcore::enquo(SubRank))
    if ( ! missing(plotItems)) plotItems <- jmvcore::resolveQuo(jmvcore::enquo(plotItems))
    if (missing(data))
        data <- jmvcore::marshalData(
            parent.frame(),
            `if`( ! missing(responses), responses, NULL),
            `if`( ! missing(groups), groups, NULL),
            `if`( ! missing(key), key, NULL),
            `if`( ! missing(weights), weights, NULL),
            `if`( ! missing(itemlabels), itemlabels, NULL),
            `if`( ! missing(SubRank), SubRank, NULL),
            `if`( ! missing(plotItems), plotItems, NULL))


    options <- nonParametricIRTOptions$new(
        responses = responses,
        groups = groups,
        key = key,
        weights = weights,
        itemlabels = itemlabels,
        format = format,
        SubRank = SubRank,
        miss = miss,
        NAweight = NAweight,
        kernel = kernel,
        bandwidth = bandwidth,
        RankFun = RankFun,
        thetadist = thetadist,
        plotItems = plotItems)

    analysis <- nonParametricIRTClass$new(
        options = options,
        data = data)

    analysis$run()

    analysis$results
}
